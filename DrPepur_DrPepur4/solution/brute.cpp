// 2008 andrewl

// os stuff
#include <windows.h>
#include <wingdi.h>

// runtime stuff
#include <stdio.h>
#include <conio.h>

// 
unsigned char HashLookupBytes[] =
{
    0x45, 0x45, 0x45, 0x45, 0xD3, 0x75, 0x42, 0x32, // EEEE.uB2
    0x69, 0x24, 0x4B, 0xAB, 0xFF, 0x14, 0x4C, 0xDC, // i$K...L.
    0x5C, 0x81, 0x28, 0x42, 0xCA, 0xB1, 0x2F, 0x35, // \.(B../5
    0x70, 0xE0, 0x26, 0xAC, 0xE6, 0xD0, 0x21, 0xDB, // p.&...!.
    0x77, 0xCD, 0x9E, 0x4B, 0xE1, 0xFD, 0x99, 0x3C, // w..K...<
    0x5B, 0xAC, 0x90, 0xA5, 0xCD, 0x9C, 0x97, 0xD2, // [.......
    0x6E, 0x09, 0xF3, 0x4C, 0xF8, 0x39, 0xF4, 0x3B, // n..L.9.;
    0x42, 0x68, 0xFD, 0xA2, 0xD4, 0x58, 0xFA, 0xD5, // Bh...X..
    0x21, 0x55, 0xF2, 0x58, 0xB7, 0x65, 0xF5, 0x2F, // !U.X.e./
    0x0D, 0x34, 0xFC, 0xB6, 0x9B, 0x04, 0xFB, 0xC1, // .4......
    0x38, 0x91, 0x9F, 0x5F, 0xAE, 0xA1, 0x98, 0x28, // 8.._...(
    0x14, 0xF0, 0x91, 0xB1, 0x82, 0xC0, 0x96, 0xC6, // ........
    0x13, 0xDD, 0x29, 0x56, 0x85, 0xED, 0x2E, 0x21, // ..)V...!
    0x3F, 0xBC, 0x27, 0xB8, 0xA9, 0x8C, 0x20, 0xCF, // ?.'... .
    0x0A, 0x19, 0x44, 0x51, 0x9C, 0x29, 0x43, 0x26, // ..DQ.)C&
    0x26, 0x78, 0x4A, 0xBF, 0xB0, 0x48, 0x4D, 0xC8, // &xJ..HM.
    0x8D, 0x65, 0x2B, 0x7E, 0x1B, 0x55, 0x2C, 0x09, // .e+~.U,.
    0xA1, 0x04, 0x25, 0x90, 0x37, 0x34, 0x22, 0xE7, // ..%.74".
    0x94, 0xA1, 0x46, 0x79, 0x02, 0x91, 0x41, 0x0E, // ..Fy..A.
    0xB8, 0xC0, 0x48, 0x97, 0x2E, 0xF0, 0x4F, 0xE0, // ..H...O.
    0xBF, 0xED, 0xF0, 0x70, 0x29, 0xDD, 0xF7, 0x07, // ...p)...
    0x93, 0x8C, 0xFE, 0x9E, 0x05, 0xBC, 0xF9, 0xE9, // ........
    0xA6, 0x29, 0x9D, 0x77, 0x30, 0x19, 0x9A, 0x00, // .).w0...
    0x8A, 0x48, 0x93, 0x99, 0x1C, 0x78, 0x94, 0xEE, // .H...x..
    0xE9, 0x75, 0x9C, 0x63, 0x7F, 0x45, 0x9B, 0x14, // .u.c.E..
    0xC5, 0x14, 0x92, 0x8D, 0x53, 0x24, 0x95, 0xFA, // ....S$..
    0xF0, 0xB1, 0xF1, 0x64, 0x66, 0x81, 0xF6, 0x13, // ...df...
    0xDC, 0xD0, 0xFF, 0x8A, 0x4A, 0xE0, 0xF8, 0xFD, // ....J...
    0xDB, 0xFD, 0x47, 0x6D, 0x4D, 0xCD, 0x40, 0x1A, // ..GmM.@.
    0xF7, 0x9C, 0x49, 0x83, 0x61, 0xAC, 0x4E, 0xF4, // ..I.a.N.
    0xC2, 0x39, 0x2A, 0x6A, 0x54, 0x09, 0x2D, 0x1D, // .9*jT.-.
    0xEE, 0x58, 0x24, 0x84, 0x78, 0x68, 0x23, 0xF3, // .X$.xh#.
    0xD5, 0x04, 0x99, 0x33, 0x43, 0x34, 0x9E, 0x44, // ...3C4.D
    0xF9, 0x65, 0x97, 0xDD, 0x6F, 0x55, 0x90, 0xAA, // .e..oU..
    0xCC, 0xC0, 0xF4, 0x34, 0x5A, 0xF0, 0xF3, 0x43, // ...4Z..C
    0xE0, 0xA1, 0xFA, 0xDA, 0x76, 0x91, 0xFD, 0xAD, // ....v...
    0xE7, 0x8C, 0x42, 0x3D, 0x71, 0xBC, 0x45, 0x4A, // ..B=q.EJ
    0xCB, 0xED, 0x4C, 0xD3, 0x5D, 0xDD, 0x4B, 0xA4, // ..L.].K.
    0xFE, 0x48, 0x2F, 0x3A, 0x68, 0x78, 0x28, 0x4D, // .H/:hx(M
    0xD2, 0x29, 0x21, 0xD4, 0x44, 0x19, 0x26, 0xA3, // .)!.D.&.
    0xB1, 0x14, 0x2E, 0x2E, 0x27, 0x24, 0x29, 0x59, // ....'$)Y
    0x9D, 0x75, 0x20, 0xC0, 0x0B, 0x45, 0x27, 0xB7, // .u ..E'.
    0xA8, 0xD0, 0x43, 0x29, 0x3E, 0xE0, 0x44, 0x5E, // ..C)>.D^
    0x84, 0xB1, 0x4D, 0xC7, 0x12, 0x81, 0x4A, 0xB0, // ..M...J.
    0x83, 0x9C, 0xF5, 0x20, 0x15, 0xAC, 0xF2, 0x57, // ... ...W
    0xAF, 0xFD, 0xFB, 0xCE, 0x39, 0xCD, 0xFC, 0xB9, // ....9...
    0x9A, 0x58, 0x98, 0x27, 0x0C, 0x68, 0x9F, 0x50, // .X.'.h.P
    0xB6, 0x39, 0x96, 0xC9, 0x20, 0x09, 0x91, 0xBE, // .9.. ...
    0x1D, 0x24, 0xF7, 0x08, 0x8B, 0x14, 0xF0, 0x7F, // .$......
    0x31, 0x45, 0xF9, 0xE6, 0xA7, 0x75, 0xFE, 0x91, // 1E...u..
    0x04, 0xE0, 0x9A, 0x0F, 0x92, 0xD0, 0x9D, 0x78, // .......x
    0x28, 0x81, 0x94, 0xE1, 0xBE, 0xB1, 0x93, 0x96, // (.......
    0x2F, 0xAC, 0x2C, 0x06, 0xB9, 0x9C, 0x2B, 0x71, // /.,...+q
    0x03, 0xCD, 0x22, 0xE8, 0x95, 0xFD, 0x25, 0x9F, // .."...%.
    0x36, 0x68, 0x41, 0x01, 0xA0, 0x58, 0x46, 0x76, // 6hA..XFv
    0x1A, 0x09, 0x4F, 0xEF, 0x8C, 0x39, 0x48, 0x98, // ..O..9H.
    0x79, 0x34, 0x40, 0x15, 0xEF, 0x04, 0x47, 0x62, // y4@...Gb
    0x55, 0x55, 0x4E, 0xFB, 0xC3, 0x65, 0x49, 0x8C, // UUN..eI.
    0x60, 0xF0, 0x2D, 0x12, 0xF6, 0xC0, 0x2A, 0x65, // `.-...*e
    0x4C, 0x91, 0x23, 0xFC, 0xDA, 0xA1, 0x24, 0x8B, // L.#...$.
    0x4B, 0xBC, 0x9B, 0x1B, 0xDD, 0x8C, 0x9C, 0x6C, // K......l
    0x67, 0xDD, 0x95, 0xF5, 0xF1, 0xED, 0x92, 0x82, // g.......
    0x52, 0x78, 0xF6, 0x1C, 0xC4, 0x48, 0xF1, 0x6B, // Rx...H.k
    0x7E, 0x19, 0xF8, 0xF2, 0xE8, 0x29, 0xFF, 0x85, // ~....)..
    0x65, 0xC6, 0xFD, 0xA8, 0xF3, 0xF6, 0xFA, 0xDF, // e.......
    0x49, 0xA7, 0xF3, 0x46, 0xDF, 0x97, 0xF4, 0x31, // I..F...1
    0x7C, 0x02, 0x90, 0xAF, 0xEA, 0x32, 0x97, 0xD8, // |....2..
    0x50, 0x63, 0x9E, 0x41, 0xC6, 0x53, 0x99, 0x36, // Pc.A.S.6
    0x57, 0x4E, 0x26, 0xA6, 0xC1, 0x7E, 0x21, 0xD1, // WN&..~!.
    0x7B, 0x2F, 0x28, 0x48, 0xED, 0x1F, 0x2F, 0x3F, // {/(H../?
    0x4E, 0x8A, 0x4B, 0xA1, 0xD8, 0xBA, 0x4C, 0xD6, // N.K...L.
    0x62, 0xEB, 0x45, 0x4F, 0xF4, 0xDB, 0x42, 0x38, // b.EO..B8
    0x01, 0xD6, 0x4A, 0xB5, 0x97, 0xE6, 0x4D, 0xC2, // ..J...M.
    0x2D, 0xB7, 0x44, 0x5B, 0xBB, 0x87, 0x43, 0x2C, // -.D[..C,
    0x18, 0x12, 0x27, 0xB2, 0x8E, 0x22, 0x20, 0xC5, // ..'.." .
    0x34, 0x73, 0x29, 0x5C, 0xA2, 0x43, 0x2E, 0x2B, // 4s)\.C.+
    0x33, 0x5E, 0x91, 0xBB, 0xA5, 0x6E, 0x96, 0xCC, // 3^...n..
    0x1F, 0x3F, 0x9F, 0x55, 0x89, 0x0F, 0x98, 0x22, // .?.U..."
    0x2A, 0x9A, 0xFC, 0xBC, 0xBC, 0xAA, 0xFB, 0xCB, // *.......
    0x06, 0xFB, 0xF2, 0x52, 0x90, 0xCB, 0xF5, 0x25, // ...R...%
    0xAD, 0xE6, 0x93, 0x93, 0x3B, 0xD6, 0x94, 0xE4, // ....;...
    0x81, 0x87, 0x9D, 0x7D, 0x17, 0xB7, 0x9A, 0x0A, // ...}....
    0xB4, 0x22, 0xFE, 0x94, 0x22, 0x12, 0xF9, 0xE3, // .".."...
    0x98, 0x43, 0xF0, 0x7A, 0x0E, 0x73, 0xF7, 0x0D, // .C.z.s..
    0x9F, 0x6E, 0x48, 0x9D, 0x09, 0x5E, 0x4F, 0xEA, // .nH..^O.
    0xB3, 0x0F, 0x46, 0x73, 0x25, 0x3F, 0x41, 0x04, // ..Fs%?A.
    0x86, 0xAA, 0x25, 0x9A, 0x10, 0x9A, 0x22, 0xED, // ..%...".
    0xAA, 0xCB, 0x2B, 0x74, 0x3C, 0xFB, 0x2C, 0x03, // ..+t<.,.
    0xC9, 0xF6, 0x24, 0x8E, 0x5F, 0xC6, 0x23, 0xF9, // ..$._.#.
    0xE5, 0x97, 0x2A, 0x60, 0x73, 0xA7, 0x2D, 0x17, // ..*`s.-.
    0xD0, 0x32, 0x49, 0x89, 0x46, 0x02, 0x4E, 0xFE, // .2I.F.N.
    0xFC, 0x53, 0x47, 0x67, 0x6A, 0x63, 0x40, 0x10, // .SGgjc@.
    0xFB, 0x7E, 0xFF, 0x80, 0x6D, 0x4E, 0xF8, 0xF7, // .~..mN..
    0xD7, 0x1F, 0xF1, 0x6E, 0x41, 0x2F, 0xF6, 0x19, // ...nA/..
    0xE2, 0xBA, 0x92, 0x87, 0x74, 0x8A, 0x95, 0xF0, // ....t...
    0xCE, 0xDB, 0x9C, 0x69, 0x58, 0xEB, 0x9B, 0x1E, // ...iX...
    0xF5, 0x87, 0x21, 0xDE, 0x63, 0xB7, 0x26, 0xA9, // ..!.c.&.
    0xD9, 0xE6, 0x2F, 0x30, 0x4F, 0xD6, 0x28, 0x47, // ../0O.(G
    0xEC, 0x43, 0x4C, 0xD9, 0x7A, 0x73, 0x4B, 0xAE, // .CL.zsK.
    0xC0, 0x22, 0x42, 0x37, 0x56, 0x12, 0x45, 0x40, // ."B7V.E@
    0xC7, 0x0F, 0xFA, 0xD0, 0x51, 0x3F, 0xFD, 0xA7, // ....Q?..
    0xEB, 0x6E, 0xF4, 0x3E, 0x7D, 0x5E, 0xF3, 0x49, // .n.>}^.I
    0xDE, 0xCB, 0x97, 0xD7, 0x48, 0xFB, 0x90, 0xA0, // ....H...
    0xF2, 0xAA, 0x99, 0x39, 0x64, 0x9A, 0x9E, 0x4E, // ...9d..N
    0x91, 0x97, 0x96, 0xC3, 0x07, 0xA7, 0x91, 0xB4, // ........
    0xBD, 0xF6, 0x98, 0x2D, 0x2B, 0xC6, 0x9F, 0x5A, // ...-+..Z
    0x88, 0x53, 0xFB, 0xC4, 0x1E, 0x63, 0xFC, 0xB3, // .S...c..
    0xA4, 0x32, 0xF5, 0x2A, 0x32, 0x02, 0xF2, 0x5D, // .2.*2..]
    0xA3, 0x1F, 0x4D, 0xCD, 0x35, 0x2F, 0x4A, 0xBA, // ..M.5/J.
    0x8F, 0x7E, 0x43, 0x23, 0x19, 0x4E, 0x44, 0x54, // .~C#.NDT
    0xBA, 0xDB, 0x20, 0xCA, 0x2C, 0xEB, 0x27, 0xBD, // .. .,.'.
    0x96, 0xBA, 0x2E, 0x24, 0x00, 0x8A, 0x29, 0x53, // ...$..)S
    0x3D, 0xA7, 0x4F, 0xE5, 0xAB, 0x97, 0x48, 0x92, // =.O...H.
    0x11, 0xC6, 0x41, 0x0B, 0x87, 0xF6, 0x46, 0x7C, // ..A...F|
    0x24, 0x63, 0x22, 0xE2, 0xB2, 0x53, 0x25, 0x95, // $c"..S%.
    0x08, 0x02, 0x2C, 0x0C, 0x9E, 0x32, 0x2B, 0x7B, // ..,..2+{
    0x0F, 0x2F, 0x94, 0xEB, 0x99, 0x1F, 0x93, 0x9C, // ./......
    0x23, 0x4E, 0x9A, 0x05, 0xB5, 0x7E, 0x9D, 0x72, // #N...~.r
    0x16, 0xEB, 0xF9, 0xEC, 0x80, 0xDB, 0xFE, 0x9B, // ........
    0x3A, 0x8A, 0xF7, 0x02, 0xAC, 0xBA, 0xF0, 0x75, // :......u
    0x59, 0xB7, 0xF8, 0xF8, 0xCF, 0x87, 0xFF, 0x8F, // Y.......
    0x75, 0xD6, 0xF6, 0x16, 0xE3, 0xE6, 0xF1, 0x61, // u......a
    0x40, 0x73, 0x95, 0xFF, 0xD6, 0x43, 0x92, 0x88, // @s...C..
    0x6C, 0x12, 0x9B, 0x11, 0xFA, 0x22, 0x9C, 0x66, // l....".f
    0x6B, 0x3F, 0x23, 0xF6, 0xFD, 0x0F, 0x24, 0x81, // k?#...$.
    0x47, 0x5E, 0x2D, 0x18, 0xD1, 0x6E, 0x2A, 0x6F, // G^-..n*o
    0x72, 0xFB, 0x4E, 0xF1, 0xE4, 0xCB, 0x49, 0x86, // r.N...I.
    0x5E, 0x9A, 0x40, 0x1F, 0xC8, 0xAA, 0x47, 0x68, // ^.@...Gh
    0x45, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00  // E.......
};


void DeriveFirstFourChars(void)
{
    for(int i='!'; i<'~'; ++i)
    for(int j='!'; j<'~'; ++j)
    for(int k='!'; k<'~'; ++k)
    for(int l='!'; l<'~'; ++l)
    {
        UINT cycles=4;
        UINT initXor=0;

        CHAR buff[5]={0};

        buff[0] = i;
        buff[1] = j;
        buff[2] = k;
        buff[3] = l;

        PUCHAR p1 = (PUCHAR)buff;
        PUCHAR p2 = (PUCHAR)HashLookupBytes;

       __asm
       {
         loc_00401913: push    esi
         loc_00401914: mov     eax, [initXor]
         loc_00401917: mov     ecx, [cycles]
         loc_0040191A: xor     eax,0FFFFFFFFh
         loc_0040191D: test    ecx,ecx
         loc_0040191F: mov     esi, [p1]
         loc_00401922: je      loc_00401939
         loc_00401924: xor     al,byte ptr [esi]
         loc_00401926: movzx   edx,al
         loc_00401929: shr     eax,8
                       push    ebp
                       mov     ebp, [p2]
         loc_0040192C: mov     edx, dword ptr[ebp + edx*4]
                       pop     ebp
         loc_00401933: inc     esi
         loc_00401934: xor     eax,edx
         loc_00401936: dec     ecx
         loc_00401937: jne     loc_00401924
         loc_00401939: xor     eax,0FFFFFFFFh
                       mov     [initXor], eax
         loc_0040193C: pop     esi
       };

        //printf("%s produced %08X\n", buff, initXor);
        //return;

       if(initXor == 0xa56eeb89)
       {
            printf("%s produced %08X\n", buff, initXor);
            printf("sweeet...\n");
            return;
       }
    }
}


void main(void)
{
    printf("hi\n");
    DeriveFirstFourChars();

    for(int i=0; i<sizeof(HashLookupBytes); ++i)
        HashLookupBytes[i] ^= 0x45;

    DeriveFirstFourChars();
}
